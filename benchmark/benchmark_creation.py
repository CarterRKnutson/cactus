"""Method script for generating some aspects of the chem benchmark"""
from pathlib import Path

import pandas as pd

HERE = Path(__file__).parent.resolve()
COMPOUND = HERE.joinpath("compound_list.csv")


def generate_permutations(templates, descriptors, molecules):
    """
    Generate questions by filling in templates with information from a DataFrame of compounds.

    Parameters
    ----------
    templates : list of str
        List of string templates with placeholders for attribute and compound.
    descriptors : list of str
        List of descriptors to be used in the generated questions.
    molecules : pandas.DataFrame
        DataFrame containing information about compounds with columns 'cid', 'canonicalsmiles',
        'cmpdname', and 'inchikey'.

    Returns
    -------
    list of str
        List of strings representing questions generated by filling in templates.

    """
    questions = []
    for template in templates:
        for descriptor in descriptors:
            for _, row in molecules.iterrows():
                compound_cid = row["cid"]
                compound_smiles = row["canonicalsmiles"]
                compound_name = row["cmpdname"]
                compound_inchikey = row["inchikey"]

                # Conditionally fill in the template based on placeholder
                if "cid" in template:
                    questions.append(template.format(attribute=descriptor, compound=compound_cid))
                elif "smiles" in template:
                    questions.append(
                        template.format(attribute=descriptor, compound=compound_smiles)
                    )
                elif "inchikey" in template:
                    questions.append(
                        template.format(attribute=descriptor, compound=compound_inchikey)
                    )
                else:
                    questions.append(template.format(attribute=descriptor, compound=compound_name))

    return questions


def main():
    templates = [
        "Calculate the {attribute} of cid: {compound}",
        "Calculate the {attribute} of the smiles: {compound}",
        "Calculate the {attribute} of the inchikey: {compound}",
        "Calculate the {attribute} of {compound}",
    ]

    pubchem_molecules = pd.read_csv(COMPOUND)
    sampled = pubchem_molecules.sample(n=25)
    descriptors = [
        "Molecular Weight",
        "QED",
        "Synthetic Accessibility",
        "Total Polar Surface Area",
        "LogP",
    ]

    questions = generate_permutations(templates, descriptors, sampled)
    question_df = pd.DataFrame(questions, columns=["Question"])

    question_df.to_csv("QuestionList.csv", index=False)


if __name__ == "__main__":
    main()
